name: Asciidoc to Html

on:
  push:
    branches:    
      - 'main'

jobs:
  Asciidoctor-Actions:
    runs-on: ubuntu-latest
    steps:
      - name: ruby Setup
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: 2.7    
      - name: Asciidoctor Setup
        uses: reitzig/actions-asciidoctor@v2.0.0
      - name: Check out repository code
        uses: actions/checkout@v2
      - name: Convert adoc to html
        run: find . -name "*.adoc" -exec asciidoctor {} -a ext=html \;
      - name: push html files
        run: |
          git remote set-url origin https://github-actions:${GITHUB_TOKEN}@github.com/${GITHUB_REPOSITORY}
          git config --global user.name "${GITHUB_ACTOR}"
          git config --global user.email "${GITHUB_ACTOR}@users.noreply.github.com"
          git add .
          git commit -a -m "[GitHub Actions] update html files for GitHub Pages"
          git push origin main
          git fetch
          git checkout -t origin/gh-pages
          git rebase origin/main
